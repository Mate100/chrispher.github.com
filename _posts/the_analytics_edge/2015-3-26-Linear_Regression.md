---
layout: post
title: TAE：线性回归
category: 统计分析
tags: [TAE, 数据分析]
description: The Analytics Edge课程下的线性回归分析入门。
---

The Analytics Edge系列的四节笔记，这是第二节：线性回归分析入门，本节课简单的介绍了线性回归，但不涉及复杂的假设检验和推导公式等。

<!-- more -->

系列笔记主要根据the analytics Edge by MITx  课件做的笔记。这门课程，主要通过各个案例来学习数据分析方法。

###目录
{:.no_toc}

* 目录
{:toc}


####课堂简要
通过如何建模以判断葡萄酒品质和棒球分析两个案例，介绍了基本的概念，包括回归模型，中间提到了残差、均方差以及p值，但没有涉及推导和数学公式。之后，通过NBA数据，提供了R语言的实现过程。做这篇笔记，核心目的是如何处理回归问题中的一些问题，尤其是如何思考问题——也许是数据分析中，最重要的事情——**常识**。

###案例一、天气预测
- ####背景与问题
考虑到全球变暖，我们想研究一下全球的平均气温与一些变量之间的关系。数据收集自1983年5月到2008年12月([climate_change.csv](https://courses.edx.org/c4x/MITx/15.071x/asset/climate_change.csv)),主要变量如下：  
- Year:观测年
- Month:观测月
- Temp: 全球平均气温(相对于某参考期)
- CO2,N2O,CH4,CFC.11,CFC.12:主要指空气重的各个成分的浓度
- Aerosols: 平流层中气溶胶平均深度(影响光线照射到地球)
- TSI: 太阳辐射总量
- MEL: 多元厄尔尼诺南方涛动指数，衡量厄尔尼诺波动情况
我们现在要通过这些变量来预测温度。
- ####认识数据与数据准备
首先，我们已经提出了问题并且找到了相关的一些数据，希望用这些数据来预测全球平均气温。我们先读取数据:  
`climate = read.csv("climate_change.csv")`;  
通过`str(climate)`,可以看到一共有11个变量，308个观测值，均是数值型数据，之后采用`summary(climate_change)`, 发现数据并没有缺失值。这里，大家可以使用`boxplot`命令，查看各个变量情况。 
之后我们要将数据集划分成训练集合和测试集合。这里请注意**考虑到时间连续性**，我们并没有按照随机选择的方法，按照7:3或8:2进行分割，而是按照时间。  
`train = subset(climate, Year <= 2006)`  
`test = subset(climate, Year > 2006)`
- ####建模
首先我们不采用年份和月份, 使用线性回归:`climatelm = lm(Temp ~ MEI + CO2 + CH4 + N2O + CFC.11 + CFC.12 + TSI + Aerosols, data=train)`  
得到结果不再详细，仅展示：Intercept=-124.6、MEI=0.06421、CO2=0.006457、CH4=0.000124、N2O =-1.653e-02、CFC.11=-0.00663，CFC.12=0.003808，TSI=0.09314，Aerosols=-1.538 。这里，我们根据P值得大小，得知CH4的系数是不显著的。但是我做这个笔记，唯一的目的只是为了：**查看各个系数，我们发现N2O和CFC-11的系数均是负数**，但是我们根据常识知道这两个气体均值温室气体，系数应该是正的才对！因此，我们觉得虽然模型不错，根据残差图也没有觉得有必要去异常值和高杠杆点或是增加高次变量或变量转换。而是基于**常识**判断出存在**多重共线性**。接下来的问题，就是去掉一些不显著变量以及相关变量处理，通过`cor`查看两两之间的相关系数(在笔记<应用线性回归>中提到具体的方法)。
- ####评估与反思
当然，我们可以在建模中，通过主动观察两两之间的相关系数或者通过计算方差膨胀因子等方法，把可能存在的各种潜在问题都去考虑一下，都去探索一下。但是，还是有很多因素和问题，是我们无法通过技术想到或评测到的，比如异常值就一定要删除吗？异常值一定就是可以通过残差图看出来？其实，很多时候，真正决定一个模型好坏的是**业务知识和常识(行业经验和准则)**。之前，一个非常有经验的人告诉我，**做数据分析，永远不要相信自己的分析结果，要有怀疑精神！模型再好，也要用常识去判断，去反思。如果不符合常识，更需要深入的去思考原因**。在很多时候，建立的模型往往因为业务的理解，增加一些或删除一些特征变量而使得结果变好，比如在医疗的癌症判断模型中，因为咨询了资深专家医师，而额外补充一个检测指标，使得最终模型可用。

###案例二、三

- ####离散值处理
使用命令:`pisaTrain$raceeth = relevel(pisaTrain$raceeth, "White")`, 结果是raceeth变量以White为基准的离散化。简单解释下：如果有三个种族黄、白、黑人，以白人为基准，那么离散的结果就是用多个0-1变量来表示：是否是黄种人，是否是黑种人，那么黄白黑分别为(1,0)(0,0),(0,1)。 
- ####变量变换
1.在谷歌流感预测中，我们发现每周访问流感医师数量呈现左偏，之后我们采用了取对数的做法，使得模型效果上升明显。  
2.在时间序列分析中，可以采用前一时刻的值作为输入。关于时间序列分析，在以后会单独讲。
- ####其他
去空值:`pisaTrain = na.omit(pisaTrain)`



